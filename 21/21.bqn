in â† â€¢FLines"input"
npc â† â¥Šâ†•â‰¢numpad â† >"789"â€¿"456"â€¿"123"â€¿" 0A"
kpc â† â¥Šâ†•â‰¢keypad â† >" ^A"â€¿"<v>"

cache â† âŸ¨âŸ©â€¢HashMapâŸ¨âŸ©
_memo â† {_ğ•£ â‹„ fâ€¿wâ€¿x â† k â† ğ•—â€¿ğ•¨â€¿ğ•©
  {cache.Has k ? cache.Get k ;
   v â† w F x
   k cache.Set v â‹„ v}}

Np â† {âŠ‘(â¥Šğ•©=numpad)/npc}
Kp â† {âŠ‘(â¥Šğ•©=keypad)/kpc}
_seq â† {yâ€¿x â† (aâ€¿bâ†ğ”½ğ•©) - câ€¿dâ†ğ”½ğ•¨
  s â† ((0âŒˆx)â¥Š'>') âˆ¾ ((0âŒˆy)â¥Š'v') âˆ¾ ((0âŒˆ-y)â¥Š'^') âˆ¾ ((0âŒˆ-x)â¥Š'<') âˆ¾ "A"
  f â† ((0âŒˆ-x)â¥Š'<') âˆ¾ ((0âŒˆy)â¥Š'v') âˆ¾ ((0âŒˆ-y)â¥Š'^') âˆ¾ ((0âŒˆx)â¥Š'>') âˆ¾ "A"
  t â† Â¬((y=0) âˆ¨ (x=0) âˆ¨ ((ğ•—=np)âˆ§(3=aâŒˆc)âˆ§0=bâŒŠd) âˆ¨ ((ğ•—=kp)âˆ§(0=aâŒŠc)âˆ§0=bâŒŠd))
  {t ? f; s} # safe or fast solution?
}
_pairwise â† {âˆ¾Â´ ğ”½Â¨ <Ë˜ 2â†•ğ•©}
KpDepthImpl â† {0 ğ•Š aâ€¿b: a Np _seq _memo b;
  d ğ•Š aâ€¿b: Kp _seq _memoÂ´ _pairwise "A"âˆ¾ (d-1) KpDepth aâ€¿b}
KpDepth â† KpDepthImpl _memo

Solve â† {(â€¢ParseFloat Â¯1â†“ğ•©) Ã—â‰  ğ•¨âŠ¸KpDepth _pairwise "A"âˆ¾ğ•©}
â€¢Show +Â´ 2 SolveÂ¨in
â€¢Show +Â´ 10 SolveÂ¨in
# TODO: somehow only save lengths, not concrete solutions... using way too much RAM
â€¢Show +Â´â‰ Â¨cache.Values@

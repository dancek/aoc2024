in    â† >â€¢FLines"/dev/stdin"
obs_  â† in='#'
pos_  â† in='^'
empty â† (â‰¢in)â†‘0
mv    â† âŸ¨Â«,Â»Ë˜,Â»,Â«Ë˜âŸ©

Round â† {pos ğ•Š obs:
  dir      â† 0
  visited  â‡ posâ€¿emptyâ€¿emptyâ€¿empty
  finished â‡ 1
  loop     â‡ 0
  Step     â‡ {ğ•Š
    npos â† (dirâ—¶mv)pos
    {ğ•Šâ‹„ âˆ¨Â´â¥Šobsâˆ§npos
      ? dir â†© 4|dir+1
      ; pos â†© npos}@
    out      â† Â¬âˆ¨Â´â¥Špos
    nvisited â† (posâŠ¸âˆ¨)âŒ¾(dirâŠ¸âŠ‘) visited
    loop     â†© nvisitedâ‰¡visited âˆ§ Â¬out
    visited  â†© nvisited
    finished â†© loop âˆ¨ out
  }
}

r â† pos_ Round obs_
{ğ•Šâ‹„ r.Step@}â€¢_while_{ğ•Šâ‹„ Â¬r.finished}@
allvisited â† âˆ¨Â´r.visited
â€¢Show +Â´â¥Šallvisited  # star 1

HasLoop â† {ğ•Š xobs:
  r â† pos_ Round xobs
  {ğ•Šâ‹„ r.Step@}â€¢_while_{ğ•Šâ‹„ Â¬r.finished}@
  r.loop
}

# split each one into a separate mask
SplitMask  â† {ğ•Š mask: {(â‰¢mask)â¥Š(â‰ â¥Šmask)â†‘/â¼âŸ¨ğ•©âŸ©}Â¨/â¥Šmask}
candidates â† obs_âŠ¸âˆ¨Â¨SplitMask allvisited

â€¢Show +Â´HasLoopÂ¨candidates  # star 2

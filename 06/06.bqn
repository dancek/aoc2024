in  â† >â€¢FLines"/dev/stdin"
obs â† in='#'
pos â† in='^'
mv  â† âŸ¨Â«,Â»Ë˜,Â»,Â«Ë˜âŸ©

dir     â† 0
empty   â† (â‰¢in)â†‘0
visited â† posâ€¿emptyâ€¿emptyâ€¿empty
Step    â† {ğ•Š
  npos â† (dirâ—¶mv)pos
  {ğ•Šâ‹„ âˆ¨Â´â¥Šobsâˆ§npos
    ? dir â†© 4|dir+1
    ; pos â†© npos}@
  visited â†© (posâŠ¸âˆ¨)âŒ¾(dirâŠ¸âŠ‘) visited
}

{ğ•Šâ‹„Step@}â€¢_while_{ğ•Šâ‹„âˆ¨Â´â¥Špos}@
â€¢Show +Â´â¥Šâˆ¨Â´visited

# failed attempt at star 2: a bit of brute force is needed
LoopObs â† {(Â¬obs)âˆ§(ğ•©â—¶mv)((4|ğ•©+1)âŠ‘visited)âˆ§ğ•©âŠ‘visited}
â€¢Show +Â´â¥Šâˆ¨Â´LoopObsÂ¨â†•4
